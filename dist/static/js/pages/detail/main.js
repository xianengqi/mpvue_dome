global.webpackJsonp([2],{"+iqk":function(t,e,n){"use strict";var o=n("x+d9");e.a={components:{Rate:o.a},props:["info"],computed:{userinfo:function(){return this.info.user_info||{}}}}},"63T1":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("5nAL"),s=n.n(o),a=n("G9XZ");new s.a(a.a).$mount()},Ehoy:function(t,e,n){"use strict";var o={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("BookInfo",{attrs:{info:t.info,mpcomid:"0"}}),t._v(" "),n("CommentList",{attrs:{comments:t.comments,mpcomid:"1"}}),t._v(" "),t.showAdd?n("div",{staticClass:"comment"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.comment,expression:"comment"}],staticClass:"textarea",attrs:{maxlength:100,placeholder:"请输入图书短评",eventid:"0"},domProps:{value:t.comment},on:{input:function(e){e.target.composing||(t.comment=e.target.value)}}}),t._v(" "),n("div",{staticClass:"location"},[t._v("\n      地理位置：\n      "),n("switch",{attrs:{color:"#EA5A49",checked:t.location,eventid:"1"},on:{change:t.getGeo}}),t._v(" "),n("span",{staticClass:"text-primary"},[t._v(t._s(t.location))])]),t._v(" "),n("div",{staticClass:"phone"},[t._v("\n      手机型号： \n      "),n("switch",{attrs:{color:"#EA5A49",checked:t.phone,eventid:"2"},on:{change:t.getPhone}}),t._v(" "),n("span",{staticClass:"text-primary"},[t._v(t._s(t.phone))])]),t._v(" "),n("button",{staticClass:"btn",attrs:{eventid:"3"},on:{click:t.addComment}},[t._v("\n      评论\n    ")])],1):n("div",{staticClass:"text-footer"},[t._v("\n    未登录或者已经评论过啦\n  ")]),t._v(" "),n("button",{staticClass:"btn",attrs:{"open-type":"share"}},[t._v("转发给好友")])],1)},staticRenderFns:[]};e.a=o},G9XZ:function(t,e,n){"use strict";var o=n("fjg2"),s=n("Ehoy");var a=function(t){n("skmT")},i=n("ybqe")(o.a,s.a,a,null,null);e.a=i.exports},SGi3:function(t,e){},Wk8O:function(t,e,n){"use strict";var o=n("+iqk"),s=n("sbyr");var a=function(t){n("SGi3")},i=n("ybqe")(o.a,s.a,a,null,null);e.a=i.exports},fjg2:function(t,e,n){"use strict";var o=n("Xxa5"),s=n.n(o),a=n("exGp"),i=n.n(a),r=n("rQBB"),c=n("Wk8O"),u=n("BpLC");e.a={components:{BookInfo:c.a,CommentList:u.a},data:function(){return{comments:[],userinfo:{},bookid:"",info:{},comment:"",location:"",phone:""}},computed:{showAdd:function(){var t=this;return!!this.userinfo.openId&&!this.comments.filter(function(e){return e.openid===t.userinfo.openId}).length}},methods:{addComment:function(){var t=this;return i()(s.a.mark(function e(){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.comment){e.next=2;break}return e.abrupt("return");case 2:return n={openid:t.userinfo.openId,bookid:t.bookid,comment:t.comment,phone:t.phone,location:t.location},e.prev=3,e.next=6,Object(r.b)("/weapp/addcomment",n);case 6:t.comment="",t.getComments(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),Object(r.c)("失败",e.t0.msg);case 13:case"end":return e.stop()}},e,t,[[3,10]])}))()},getDetail:function(){var t=this;return i()(s.a.mark(function e(){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(r.a)("/weapp/bookdetail",{id:t.bookid});case 2:n=e.sent,wx.setNavigationBarTitle({title:n.title}),t.info=n;case 5:case"end":return e.stop()}},e,t)}))()},getComments:function(){var t=this;return i()(s.a.mark(function e(){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(r.a)("/weapp/commentlist",{bookid:t.bookid});case 2:n=e.sent,console.log("comments",n),t.comments=n.list||[];case 5:case"end":return e.stop()}},e,t)}))()},getGeo:function(t){var e=this;t.target.value?wx.getLocation({success:function(t){wx.request({url:"http://api.map.baidu.com/geocoder/v2/",data:{ak:"6VlPBlmwFjUowhU4gZ3Q1zeG19ZPYzGr",location:t.latitude+", "+t.longitude,output:"json"},success:function(t){console.log(t),0==t.data.status?e.location=t.data.result.addressComponent.city:e.location="未知地点"}})}}):this.location=""},getPhone:function(t){if(console.log("手机型号获取中"),t.target.value){var e=wx.getSystemInfoSync();this.phone=e.model}else this.phone=""}},mounted:function(){this.bookid=this.$root.$mp.query.id,this.getDetail(),this.getComments();var t=wx.getStorageSync("userinfo");console.log("userinfo",t),t&&(this.userinfo=t)}}},sbyr:function(t,e,n){"use strict";var o={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"bookinfo"},[n("div",{staticClass:"thumb"},[n("img",{staticClass:"back",attrs:{src:t.info.image,mode:"aspectFill"}}),t._v(" "),n("img",{staticClass:"img",attrs:{src:t.info.image,mode:"aspectFit"}}),t._v(" "),n("div",{staticClass:"info"},[n("div",{staticClass:"title"},[t._v("\n           "+t._s(t.info.title)+"\n         ")]),t._v(" "),n("div",{staticClass:"author"},[t._v("\n           "+t._s(t.info.author)+"\n         ")])])]),t._v(" "),n("div",{staticClass:"detail"},[n("img",{staticClass:"avatar",attrs:{src:t.userinfo.image,mode:"aspectFit"}}),t._v("\n    "+t._s(t.userinfo.name)+"\n    "),n("div",{staticClass:"right text-primary"},[t._v("\n      "+t._s(t.info.rate)+"分\n      "),n("Rate",{attrs:{value:t.info.rate,mpcomid:"0"}})],1)]),t._v(" "),n("div",{staticClass:"detail"},[t._v("\n    "+t._s(t.info.publisher)+"\n    "),n("div",{staticClass:"right"},[t._v("\n      "+t._s(t.info.price)+"\n    ")])]),t._v(" "),n("div",{staticClass:"tags"},t._l(t.info.tags,function(e,o){return n("div",{key:e,staticClass:"badge"},[t._v("\n      "+t._s(e)+"\n    ")])})),t._v(" "),n("div",{staticClass:"summary"},t._l(t.info.summary,function(e,o){return n("p",{key:o},[t._v(t._s(e))])}))])},staticRenderFns:[]};e.a=o},skmT:function(t,e){}},["63T1"]);